<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BhenzFlix Music</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(black,#200000);
    color:white;
    text-align:center;
}

.topbar{
    background:#111;
    padding:15px;
    font-size:20px;
    letter-spacing:4px;
    color:red;
    box-shadow:0 0 20px red;
}

.album{
    width:230px;
    height:230px;
    border-radius:50%;
    margin:20px auto;
    box-shadow:0 0 40px red;
    overflow:hidden;
}

#cover{
    width:100%;
    height:100%;
    object-fit:cover;
}

.controls button{
    background:none;
    border:none;
    color:white;
    font-size:24px;
    margin:10px;
}

canvas{
    width:100%;
    height:180px;
}

.search-box{
    width:90%;
    padding:8px;
    margin:10px auto;
    display:block;
    border:none;
    border-radius:5px;
}

.playlist{
    width:90%;
    margin:10px auto;
    max-height:300px;
    overflow-y:auto;
    border-top:1px solid #333;
}

.song{
    padding:8px;
    border-bottom:1px solid #222;
    cursor:pointer;
    font-size:13px;
}

.song:hover{
    background:#111;
}

.song.active{
    color:red;
}
</style>
</head>

<body>

<div class="topbar">üéµ BHENZFLIX MUSIC</div>

<div class="album">
    <img id="cover" src="https://picsum.photos/400/400?random=1">
</div>

<div id="title">Loading...</div>

<div class="controls">
    <button onclick="prevSong()">‚èÆ</button>
    <button onclick="playPause()">‚ñ∂</button>
    <button onclick="nextSong()">‚è≠</button>
    <button onclick="toggleShuffle()">üîÄ</button>
    <button onclick="toggleRepeat()">üîÅ</button>
</div>

<canvas id="visualizer"></canvas>

<input type="text" id="search" class="search-box" placeholder="Search song...">

<div class="playlist" id="playlist"></div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>

const repoBase = "https://raw.githubusercontent.com/carranzabhenz35-blip/BhenzFlix/main/";

const songs = [

"04 - Avenged Sevenfold - Buried Alive.mp3",
"10 - Avenged Sevenfold - Unholy Confessions.mp3",
"13 - Avenged Sevenfold - Seize the Day.mp3",
"14 - Avenged Sevenfold - Nobody.mp3",
"18 - Avenged Sevenfold - Blinded in Chains.mp3",
"35 - Avenged Sevenfold - 4_00 AM.mp3",
"37 - Avenged Sevenfold - Crossroads.mp3",

"07 - Linkin Park - What I've Done.mp3",
"13 - Linkin Park - Bleed It Out.mp3",
"15 - Linkin Park - Given Up.mp3",

"03 - Red Hot Chili Peppers - Californication.mp3",
"05 - Red Hot Chili Peppers - Scar Tissue.mp3",
"06 - Red Hot Chili Peppers - Snow (Hey Oh).mp3"

];

let filteredSongs = [...songs];
let current = 0;
let shuffle = false;
let repeatMode = 0; // 0 off, 1 repeat all, 2 repeat one

const audio = document.getElementById("audio");
const title = document.getElementById("title");
const playlistDiv = document.getElementById("playlist");
const cover = document.getElementById("cover");
const searchInput = document.getElementById("search");

function loadSong(index){
    audio.src = encodeURI(repoBase + filteredSongs[index]);
    title.innerText = filteredSongs[index];
    cover.src = "https://picsum.photos/400/400?random=" + Math.random();
    highlight();
}

function playPause(){
    audioCtx.resume();
    if(audio.paused) audio.play();
    else audio.pause();
}

function nextSong(){
    if(shuffle){
        current = Math.floor(Math.random()*filteredSongs.length);
    } else {
        current++;
        if(current >= filteredSongs.length){
            if(repeatMode==1) current=0;
            else return;
        }
    }
    loadSong(current);
    audio.play();
}

function prevSong(){
    current--;
    if(current<0) current=filteredSongs.length-1;
    loadSong(current);
    audio.play();
}

function toggleShuffle(){
    shuffle=!shuffle;
    alert("Shuffle: "+(shuffle?"ON":"OFF"));
}

function toggleRepeat(){
    repeatMode++;
    if(repeatMode>2) repeatMode=0;
    const modes=["Repeat OFF","Repeat ALL","Repeat ONE"];
    alert(modes[repeatMode]);
}

audio.addEventListener("ended",()=>{
    if(repeatMode==2){
        audio.play();
    } else {
        nextSong();
    }
});

function highlight(){
    const items=document.querySelectorAll(".song");
    items.forEach((el,i)=>{
        el.classList.remove("active");
        if(i===current) el.classList.add("active");
    });
}

function buildPlaylist(){
    playlistDiv.innerHTML="";
    filteredSongs.forEach((song,index)=>{
        const div=document.createElement("div");
        div.classList.add("song");
        div.innerText=song;
        div.onclick=()=>{
            current=index;
            loadSong(current);
            audio.play();
        };
        playlistDiv.appendChild(div);
    });
}

searchInput.addEventListener("input",()=>{
    const searchTerm=searchInput.value.toLowerCase();
    filteredSongs=songs.filter(song=>song.toLowerCase().includes(searchTerm));
    current=0;
    buildPlaylist();
    if(filteredSongs.length>0) loadSong(0);
});

buildPlaylist();
loadSong(current);

/* VISUALIZER */
const canvas=document.getElementById("visualizer");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=180;

const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
const analyser=audioCtx.createAnalyser();
const source=audioCtx.createMediaElementSource(audio);
source.connect(analyser);
analyser.connect(audioCtx.destination);
analyser.fftSize=256;

const bufferLength=analyser.frequencyBinCount;
const dataArray=new Uint8Array(bufferLength);

function animate(){
    requestAnimationFrame(animate);
    analyser.getByteFrequencyData(dataArray);
    ctx.fillStyle="black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    const barWidth=(canvas.width/bufferLength)*2;
    let x=0;

    for(let i=0;i<bufferLength;i++){
        const barHeight=dataArray[i];
        const r=barHeight+50;
        const g=50;
        const b=150;
        ctx.fillStyle="rgb("+r+","+g+","+b+")";
        ctx.fillRect(x,canvas.height-barHeight,barWidth-2,barHeight);
        x+=barWidth;
    }
}
animate();

</script>

</body>
</html>
